<div class="row margin-list">
  <div class="main-container">
    <div class="title-search-bar col-sm-8">
      <div class="logo-and-search-bar z-depth-2 fa-2x" id="navbar-fixed">
        <div class="flex-btn-search-bar">
          <div class="logo-search-bar">
            <i class="fas fa-search"></i>
          </div>
          <div class="search-bar-houses">
            <%= form_tag houses_path, method: :get do %>
              <%= text_field_tag :query,
                params[:query],
                placeholder: "Adresse et / ou Proprietaire" %>
            <% end %>
          </div>
        </div>
        <div class="btn-search-bar">
          <%= link_to "CrÃ©er un bien", new_house_path, class:"btn-base" %>
        </div>
      </div>
      <% @houses.each do |house| %>
        <%= link_to house_path(house), class:"message-hover" do %>
          <div class="message z-depth-3" data-house-id="<%= house.id %>">
            <div class="message-name">
              <h5><%= house.address %></h5>
              <p>
                Prop:
                <%= house.owner.first_name %>
                <%= house.owner.last_name %>
              </p>
            </div>
            <div class="message-body">
              <p><strong>
                <% case house.house_type %>
                  <% when "Maison" then %>
                    <i class='fas fa-home fa-2x' data-toggle="tooltip" data-placement="bottom" title="Maison"></i>
                  <% when "Appartement" then %>
                    <i class='fas fa-building fa-2x' data-toggle="tooltip" data-placement="bottom" title="Appartement"></i>
                <% end %>
              </strong></p>
            </div>
            <div class="message-type">
               <% if house.exclusive %>
                  <i class="fas fa-star fa-2x iconcog" data-toggle="tooltip" data-placement="bottom" title="exclusive"></i>
               <% else %>
               <% end %>
            </div>
            <div class="message-status">
              <% if !Document.all.empty? %>
                <% if Document.all.map{|d| d.house_id}.uniq.include?(house.id) %>
                  <i class="fas fa-file-pdf fa-2x icon-green" data-toggle="tooltip" data-placement="bottom" title="Dossier complet"></i>
                <% else %>
                  <i class="fas fa-file-pdf fa-2x icon-red" data-toggle="tooltip" data-placement="bottom" title="Dossier incomplet"></i>
               <% end %>
               <%else %>
                   <i class="fas fa-file-pdf fa-2x icon-red" data-toggle="tooltip" data-placement="bottom" title="Dossier incomplet"></i>
               <% end %>
            </div>
            <div class="message-signature-attente">
              <% if !Document.all.empty? %>
                <% if Document.all.map{|d| d.house_id}.uniq.include?(house.id) %>
                  <% if Document.all.find{|d| d.house_id = house.id}.docusign_envelope_id != "0"%>
                    <i class="fas fa-pen-fancy fa-2x iconcog" data-toggle="tooltip" data-placement="bottom" title="signature en attente"></i>
                  <% else %>
                    <i class="fas fa-pen-fancy fa-2x icon-red" data-toggle="tooltip" data-placement="bottom" title="en attente d'envoi pour signature"></i>
                  <% end %>
                <%else %>
                 <% end %>
               <%else %>
               <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="col-sm-4">
      <div class="map-index">
        <div id="mapid" data-markers=" <%= @markers.to_json %>"></div>
      </div>
    </div>
  </div>
</div>


